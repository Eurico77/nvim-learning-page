<!doctype html>
<html lang="pt-BR">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Mapa Interativo de Motions do Vim/Nvim</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Fira+Code:wght@400;500&display=swap"
      rel="stylesheet"
    />
    <!-- Chosen Palette: Calm Harmony (Stone, Muted Green) -->
    <!-- Application Structure Plan: A tab-based SPA with a main navigation for Vim modes (Normal, Insert, Visual) and a dynamic sub-navigation for proficiency levels within Normal mode. Content is displayed in a filterable grid of cards. This structure was chosen to transform the linear text document into an interactive, explorable tool, allowing users to focus on specific concepts without scrolling, which enhances targeted learning and reduces cognitive load. -->
    <!-- Visualization & Content Choices: Report Info: Vim commands/descriptions -> Goal: Organize/Inform -> Viz/Presentation: Interactive card grid -> Interaction: JS-powered filtering via navigation buttons -> Justification: Cards modularize information for easy digestion, and filtering provides a focused learning path, which is superior to a static text file. Method: HTML/Tailwind for structure/style, Vanilla JS for interactivity. -->
    <!-- CONFIRMATION: NO SVG graphics used. NO Mermaid JS used. -->
    <script>
      tailwind.config = {
        darkMode: "class",
      };
    </script>
    <style>
      body {
        font-family: "Inter", sans-serif;
      }
      .fira-code {
        font-family: "Fira Code", monospace;
      }
      .nav-btn,
      .sub-nav-btn,
      .plugin-nav-btn,
      .card {
        transition: all 0.2s ease-in-out;
      }
      .card:hover {
        transform: translateY(-4px);
        box-shadow:
          0 10px 15px -3px rgb(0 0 0 / 0.1),
          0 4px 6px -4px rgb(0 0 0 / 0.1);
      }
      .dark .card:hover {
        box-shadow:
          0 10px 15px -3px rgb(0 0 0 / 0.2),
          0 4px 6px -4px rgb(0 0 0 / 0.2);
      }
      #explanation-modal-content pre {
        white-space: pre-wrap;
        word-wrap: break-word;
        background-color: #f3f4f6;
        padding: 1rem;
        border-radius: 0.5rem;
        font-family: "Fira Code", monospace;
      }
      .dark #explanation-modal-content pre {
        background-color: #1f2937;
      }
      .loader {
        border: 4px solid #f3f3f3;
        border-top: 4px solid #3498db;
        border-radius: 50%;
        width: 40px;
        height: 40px;
        animation: spin 1s linear infinite;
      }
      @keyframes spin {
        0% {
          transform: rotate(0deg);
        }
        100% {
          transform: rotate(360deg);
        }
      }
    </style>
  </head>
  <body
    class="bg-stone-100 text-stone-800 dark:bg-stone-900 dark:text-stone-300 antialiased"
  >
    <div class="absolute top-4 right-4">
      <button
        id="theme-toggle"
        class="p-2 rounded-full bg-stone-200 dark:bg-stone-800 text-stone-600 dark:text-stone-300 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-700 dark:focus:ring-offset-stone-900"
      >
        <svg
          id="theme-icon-light"
          class="w-6 h-6 hidden"
          fill="none"
          stroke="currentColor"
          viewBox="0 0 24 24"
          xmlns="http://www.w3.org/2000/svg"
        >
          <path
            stroke-linecap="round"
            stroke-linejoin="round"
            stroke-width="2"
            d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z"
          ></path>
        </svg>
        <svg
          id="theme-icon-dark"
          class="w-6 h-6 hidden"
          fill="none"
          stroke="currentColor"
          viewBox="0 0 24 24"
          xmlns="http://www.w3.org/2000/svg"
        >
          <path
            stroke-linecap="round"
            stroke-linejoin="round"
            stroke-width="2"
            d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z"
          ></path>
        </svg>
      </button>
    </div>

    <div class="container mx-auto px-4 py-8 md:py-12">
      <header class="text-center mb-10">
        <h1
          class="text-4xl md:text-5xl font-bold text-stone-900 dark:text-stone-100"
        >
          Mapa Interativo de Motions
        </h1>
        <p class="mt-2 text-lg text-stone-600 dark:text-stone-400">
          Um guia para dominar a navegação no Vim/Nvim.
        </p>
      </header>

      <main>
        <nav
          id="main-nav"
          class="flex justify-center items-center gap-2 md:gap-4 mb-8 p-2 bg-stone-200 dark:bg-stone-800 rounded-xl max-w-md mx-auto"
        >
          <button
            data-mode="normal"
            class="nav-btn w-full py-2 px-4 rounded-lg font-semibold text-stone-700 dark:text-stone-200 data-[active]:bg-green-800 data-[active]:text-green-50 data-[active]:shadow-md dark:data-[active]:bg-green-600"
          >
            Modo Normal
          </button>
          <button
            data-mode="insert"
            class="nav-btn w-full py-2 px-4 rounded-lg font-semibold text-stone-700 dark:text-stone-200 data-[active]:bg-green-800 data-[active]:text-green-50 data-[active]:shadow-md dark:data-[active]:bg-green-600"
          >
            Modo de Inserção
          </button>
          <button
            data-mode="visual"
            class="nav-btn w-full py-2 px-4 rounded-lg font-semibold text-stone-700 dark:text-stone-200 data-[active]:bg-green-800 data-[active]:text-green-50 data-[active]:shadow-md dark:data-[active]:bg-green-600"
          >
            Modo Visual
          </button>
        </nav>

        <div id="sub-nav-container" class="mb-10">
          <div
            id="sub-nav-normal"
            class="sub-nav flex flex-wrap justify-center gap-2 md:gap-3 bg-stone-200/50 dark:bg-stone-800/50 p-2 rounded-xl max-w-2xl mx-auto"
          >
            <button
              data-level="all"
              class="sub-nav-btn py-1 px-3 text-sm rounded-md font-medium text-stone-600 dark:text-stone-300 data-[active]:bg-lime-400 data-[active]:text-lime-950 dark:data-[active]:bg-lime-500 dark:data-[active]:text-lime-950"
            >
              Todos
            </button>
            <button
              data-level="1"
              class="sub-nav-btn py-1 px-3 text-sm rounded-md font-medium text-stone-600 dark:text-stone-300 data-[active]:bg-lime-400 data-[active]:text-lime-950 dark:data-[active]:bg-lime-500 dark:data-[active]:text-lime-950"
            >
              Nível 1: Base
            </button>
            <button
              data-level="2"
              class="sub-nav-btn py-1 px-3 text-sm rounded-md font-medium text-stone-600 dark:text-stone-300 data-[active]:bg-lime-400 data-[active]:text-lime-950 dark:data-[active]:bg-lime-500 dark:data-[active]:text-lime-950"
            >
              Nível 2: Palavras
            </button>
            <button
              data-level="3"
              class="sub-nav-btn py-1 px-3 text-sm rounded-md font-medium text-stone-600 dark:text-stone-300 data-[active]:bg-lime-400 data-[active]:text-lime-950 dark:data-[active]:bg-lime-500 dark:data-[active]:text-lime-950"
            >
              Nível 3: Linha
            </button>
            <button
              data-level="4"
              class="sub-nav-btn py-1 px-3 text-sm rounded-md font-medium text-stone-600 dark:text-stone-300 data-[active]:bg-lime-400 data-[active]:text-lime-950 dark:data-[active]:bg-lime-500 dark:data-[active]:text-lime-950"
            >
              Nível 4: Arquivo
            </button>
            <button
              data-level="5"
              class="sub-nav-btn py-1 px-3 text-sm rounded-md font-medium text-stone-600 dark:text-stone-300 data-[active]:bg-lime-400 data-[active]:text-lime-950 dark:data-[active]:bg-lime-500 dark:data-[active]:text-lime-950"
            >
              Nível 5: Gramática
            </button>
          </div>
        </div>

        <div id="content-intro" class="text-center max-w-3xl mx-auto mb-10">
          <h2
            id="intro-title"
            class="text-2xl font-bold mb-2 text-stone-900 dark:text-stone-100"
          ></h2>
          <p id="intro-text" class="text-stone-600 dark:text-stone-400"></p>
        </div>

        <div
          id="commands-grid"
          class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4 md:gap-6"
        ></div>
      </main>

      <section id="plugin-keybinds" class="mt-16">
        <div class="text-center mb-10">
          <h2 class="text-3xl font-bold text-stone-900 dark:text-stone-100">
            Seus Keybinds de Plugins
          </h2>
          <p class="mt-2 text-lg text-stone-600 dark:text-stone-400">
            Atalhos personalizados da sua configuração.
          </p>
        </div>
        <div
          class="flex flex-wrap justify-center gap-2 border-b-2 border-stone-200 dark:border-stone-700 mb-8"
        >
          <button
            data-plugin="neotree"
            class="plugin-nav-btn font-medium py-2 px-4 border-b-2 border-transparent text-stone-500 dark:text-stone-400 data-[active]:border-green-800 data-[active]:bg-green-100 data-[active]:text-green-800 dark:data-[active]:border-green-400 dark:data-[active]:bg-stone-800 dark:data-[active]:text-green-400"
          >
            Neotree
          </button>
          <button
            data-plugin="telescope"
            class="plugin-nav-btn font-medium py-2 px-4 border-b-2 border-transparent text-stone-500 dark:text-stone-400 data-[active]:border-green-800 data-[active]:bg-green-100 data-[active]:text-green-800 dark:data-[active]:border-green-400 dark:data-[active]:bg-stone-800 dark:data-[active]:text-green-400"
          >
            Telescope
          </button>
          <button
            data-plugin="lsp"
            class="plugin-nav-btn font-medium py-2 px-4 border-b-2 border-transparent text-stone-500 dark:text-stone-400 data-[active]:border-green-800 data-[active]:bg-green-100 data-[active]:text-green-800 dark:data-[active]:border-green-400 dark:data-[active]:bg-stone-800 dark:data-[active]:text-green-400"
          >
            LSP
          </button>
          <button
            data-plugin="harpoon"
            class="plugin-nav-btn font-medium py-2 px-4 border-b-2 border-transparent text-stone-500 dark:text-stone-400 data-[active]:border-green-800 data-[active]:bg-green-100 data-[active]:text-green-800 dark:data-[active]:border-green-400 dark:data-[active]:bg-stone-800 dark:data-[active]:text-green-400"
          >
            Harpoon
          </button>
          <button
            data-plugin="geral"
            class="plugin-nav-btn font-medium py-2 px-4 border-b-2 border-transparent text-stone-500 dark:text-stone-400 data-[active]:border-green-800 data-[active]:bg-green-100 data-[active]:text-green-800 dark:data-[active]:border-green-400 dark:data-[active]:bg-stone-800 dark:data-[active]:text-green-400"
          >
            Geral
          </button>
        </div>
        <div
          id="plugin-grid"
          class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4"
        ></div>
      </section>

      <footer
        class="mt-16 text-center border-t border-stone-300 dark:border-stone-700 pt-8"
      >
        <h3 class="text-xl font-bold mb-4 text-stone-900 dark:text-stone-100">
          Como Usar Este Mapa
        </h3>
        <div
          class="max-w-3xl mx-auto text-stone-600 dark:text-stone-400 space-y-2"
        >
          <p>
            <strong>1. Foco Semanal:</strong> Dedique uma semana para cada
            "Nível" do Modo Normal para construir uma base sólida.
          </p>
          <p>
            <strong>2. Prática Ativa:</strong> Use os botões de filtro para se
            concentrar em um conjunto de comandos. Abra seu editor e pratique-os
            em um arquivo real.
          </p>
          <p>
            <strong>3. Combine e Crie:</strong> Lembre-se que o poder do Vim
            está na composição: **operador + movimento**. Experimente combinar
            os operadores (`d`, `c`, `y`) com os movimentos que você aprende.
          </p>
        </div>
      </footer>
    </div>

    <div
      id="explanation-modal"
      class="fixed inset-0 bg-black bg-opacity-50 dark:bg-opacity-70 hidden items-center justify-center p-4"
    >
      <div
        class="bg-white dark:bg-stone-800 rounded-lg shadow-xl w-full max-w-2xl max-h-[80vh] flex flex-col"
      >
        <div
          class="flex justify-between items-center p-4 border-b border-stone-200 dark:border-stone-700"
        >
          <h3
            id="explanation-modal-title"
            class="text-xl font-bold fira-code text-green-800 dark:text-green-400"
          ></h3>
          <button
            id="explanation-modal-close"
            class="text-stone-500 hover:text-stone-800 dark:hover:text-stone-200"
          >
            &times;
          </button>
        </div>
        <div
          id="explanation-modal-content"
          class="p-6 overflow-y-auto text-stone-700 dark:text-stone-300"
        >
          <div class="flex justify-center items-center h-32">
            <div class="loader"></div>
          </div>
        </div>
      </div>
    </div>

    <script>
      const commandsData = [
        {
          mode: "normal",
          level: 1,
          key: "h",
          desc: "Move o cursor para a esquerda.",
        },
        {
          mode: "normal",
          level: 1,
          key: "j",
          desc: "Move o cursor para baixo.",
        },
        {
          mode: "normal",
          level: 1,
          key: "k",
          desc: "Move o cursor para cima.",
        },
        {
          mode: "normal",
          level: 1,
          key: "l",
          desc: "Move o cursor para a direita.",
        },
        {
          mode: "normal",
          level: 2,
          key: "w",
          desc: "Pula para o início da próxima palavra.",
        },
        {
          mode: "normal",
          level: 2,
          key: "b",
          desc: "Volta para o início da palavra anterior.",
        },
        {
          mode: "normal",
          level: 2,
          key: "e",
          desc: "Pula para o final da palavra atual/próxima.",
        },
        {
          mode: "normal",
          level: 2,
          key: "ge",
          desc: "Volta para o final da palavra anterior.",
        },
        {
          mode: "normal",
          level: 2,
          key: "W, B, E",
          desc: 'Versões "maiusculas", ignoram pontuações.',
        },
        {
          mode: "normal",
          level: 3,
          key: "0",
          desc: "Vai para o início absoluto da linha.",
        },
        {
          mode: "normal",
          level: 3,
          key: "^",
          desc: "Vai para o primeiro caractere não-branco.",
        },
        {
          mode: "normal",
          level: 3,
          key: "$",
          desc: "Vai para o final da linha.",
        },
        {
          mode: "normal",
          level: 3,
          key: "f{char}",
          desc: "Encontra a próxima ocorrência de {char}.",
        },
        {
          mode: "normal",
          level: 3,
          key: "F{char}",
          desc: "Encontra a ocorrência anterior de {char}.",
        },
        {
          mode: "normal",
          level: 3,
          key: "t{char}",
          desc: "Move até antes da próxima ocorrência de {char}.",
        },
        {
          mode: "normal",
          level: 3,
          key: "T{char}",
          desc: "Move até depois da ocorrência anterior de {char}.",
        },
        {
          mode: "normal",
          level: 3,
          key: ";",
          desc: "Repete o último comando f, F, t, ou T.",
        },
        {
          mode: "normal",
          level: 3,
          key: ",",
          desc: "Repete o último comando na direção oposta.",
        },
        {
          mode: "normal",
          level: 4,
          key: "gg",
          desc: "Vai para a primeira linha do arquivo.",
        },
        {
          mode: "normal",
          level: 4,
          key: "G",
          desc: "Vai para a última linha do arquivo.",
        },
        {
          mode: "normal",
          level: 4,
          key: "{n}G",
          desc: "Vai para a linha de número {n}.",
        },
        {
          mode: "normal",
          level: 4,
          key: "Ctrl + d",
          desc: "Rola meia página para baixo.",
        },
        {
          mode: "normal",
          level: 4,
          key: "Ctrl + u",
          desc: "Rola meia página para cima.",
        },
        {
          mode: "normal",
          level: 4,
          key: "%",
          desc: "Pula para o parêntese/colchete/chave correspondente.",
        },
        {
          mode: "normal",
          level: 5,
          key: "d + motion",
          desc: "Deleta (recorta) o texto coberto pelo movimento.",
        },
        {
          mode: "normal",
          level: 5,
          key: "c + motion",
          desc: "Muda (deleta e entra em modo de inserção).",
        },
        {
          mode: "normal",
          level: 5,
          key: "y + motion",
          desc: "Copia (yank) o texto.",
        },
        {
          mode: "normal",
          level: 5,
          key: "dw",
          desc: "Ex: Deleta uma palavra.",
        },
        {
          mode: "normal",
          level: 5,
          key: "d$",
          desc: "Ex: Deleta até o final da linha.",
        },
        {
          mode: "normal",
          level: 5,
          key: "caw",
          desc: "Ex: Muda a palavra inteira (change around word).",
        },
        {
          mode: "normal",
          level: 5,
          key: 'ci"',
          desc: "Ex: Muda o conteúdo dentro das aspas.",
        },
        {
          mode: "normal",
          level: 5,
          key: "yy",
          desc: "Ex: Copia a linha inteira.",
        },
        {
          mode: "normal",
          level: 5,
          key: "dG",
          desc: "Ex: Deleta até o final do arquivo.",
        },
        {
          mode: "normal",
          level: 5,
          key: "ggdG",
          desc: "Ex: Deleta todo o conteúdo do arquivo.",
        },
        {
          mode: "insert",
          key: "i",
          desc: "Entra no modo de inserção antes do cursor.",
        },
        {
          mode: "insert",
          key: "a",
          desc: "Entra no modo de inserção depois do cursor.",
        },
        {
          mode: "insert",
          key: "I",
          desc: "Entra no modo de inserção no início da linha.",
        },
        {
          mode: "insert",
          key: "A",
          desc: "Entra no modo de inserção no final da linha.",
        },
        {
          mode: "insert",
          key: "o",
          desc: "Cria uma nova linha abaixo e entra em inserção.",
        },
        {
          mode: "insert",
          key: "O",
          desc: "Cria uma nova linha acima e entra em inserção.",
        },
        {
          mode: "insert",
          key: "Esc / Ctrl+[",
          desc: "Volta para o Modo Normal.",
        },
        {
          mode: "visual",
          key: "v",
          desc: "Inicia modo Visual (seleção por caractere).",
        },
        { mode: "visual", key: "V", desc: "Inicia modo Visual por linha." },
        {
          mode: "visual",
          key: "Ctrl + v",
          desc: "Inicia modo Visual em bloco (retangular).",
        },
        { mode: "visual", key: "d / x", desc: "Deleta (recorta) a seleção." },
        { mode: "visual", key: "y", desc: "Copia a seleção." },
        { mode: "visual", key: "c", desc: "Muda a seleção." },
        { mode: "visual", key: ">", desc: "Aumenta a indentação da seleção." },
        { mode: "visual", key: "<", desc: "Diminui a indentação da seleção." },
        {
          mode: "visual",
          key: "U",
          desc: "Converte a seleção para MAIÚSCULAS.",
        },
        {
          mode: "visual",
          key: "u",
          desc: "Converte a seleção para minúsculas.",
        },
        {
          mode: "visual",
          key: "ggVG",
          desc: "Seleciona todo o conteúdo do arquivo.",
        },
        {
          mode: "visual",
          key: "viw",
          desc: "Seleciona a palavra interna (inner word).",
        },
        {
          mode: "visual",
          key: "vaw",
          desc: "Seleciona uma palavra (a word), incluindo espaços.",
        },
        {
          mode: "visual",
          key: 'vi"',
          desc: "Seleciona o conteúdo dentro de aspas duplas.",
        },
        {
          mode: "visual",
          key: "vi(",
          desc: "Seleciona o conteúdo dentro de parênteses.",
        },
        { mode: "visual", key: "vip", desc: "Seleciona o parágrafo interno." },
      ];

      const pluginKeybinds = [
        { plugin: "neotree", key: "<leader>e", desc: "Alternar NeoTree" },
        {
          plugin: "neotree",
          key: "<leader>o",
          desc: "Revelar arquivo no NeoTree",
        },
        { plugin: "neotree", key: "<leader>ef", desc: "Focar no NeoTree" },
        { plugin: "telescope", key: "<leader>sh", desc: "[P]esquisar [A]juda" },
        {
          plugin: "telescope",
          key: "<leader>sk",
          desc: "[P]esquisar [M]apas de Teclas",
        },
        {
          plugin: "telescope",
          key: "<leader>sf",
          desc: "[P]esquisar [A]rquivos",
        },
        {
          plugin: "telescope",
          key: "<leader>ss",
          desc: "[P]esquisar [S]elecionar Telescope",
        },
        {
          plugin: "telescope",
          key: "<leader>sw",
          desc: "[P]esquisar [P]alavra atual",
        },
        {
          plugin: "telescope",
          key: "<leader>sg",
          desc: "[P]esquisar por [G]rep",
        },
        {
          plugin: "telescope",
          key: "<leader>sd",
          desc: "[P]esquisar [D]iagnósticos",
        },
        {
          plugin: "telescope",
          key: "<leader>sr",
          desc: "[P]esquisar e [R]esumir",
        },
        {
          plugin: "telescope",
          key: "<leader>s.",
          desc: "[P]esquisar Arquivos Recentes",
        },
        {
          plugin: "telescope",
          key: "<leader><leader>",
          desc: "Encontrar buffers existentes",
        },
        {
          plugin: "telescope",
          key: "<leader>/",
          desc: 'Pesquisa "fuzzy" no buffer atual',
        },
        {
          plugin: "telescope",
          key: "<leader>s/",
          desc: "[P]esquisar [/] em Arquivos Abertos",
        },
        {
          plugin: "telescope",
          key: "<leader>sn",
          desc: "[P]esquisar arquivos do [N]eovim",
        },
        { plugin: "lsp", key: "grn", desc: "[R]e[n]omear" },
        { plugin: "lsp", key: "gra", desc: "Ir para [A]ção de Código" },
        { plugin: "lsp", key: "grr", desc: "Ir para [R]eferências" },
        { plugin: "lsp", key: "gri", desc: "Ir para [I]mplementação" },
        { plugin: "lsp", key: "grd", desc: "Ir para [D]efinição" },
        { plugin: "lsp", key: "grD", desc: "Ir para [D]eclaração" },
        { plugin: "lsp", key: "gO", desc: "Abrir Símbolos do Documento" },
        { plugin: "lsp", key: "gW", desc: "Abrir Símbolos do Workspace" },
        { plugin: "lsp", key: "grt", desc: "Ir para Definição de [T]ipo" },
        {
          plugin: "lsp",
          key: "<leader>th",
          desc: "Alternar Dicas Inlay ([H]ints)",
        },
        { plugin: "lsp", key: "<leader>f", desc: "[F]ormatar buffer" },
        {
          plugin: "harpoon",
          key: "<leader>a",
          desc: "Adicionar arquivo à lista do Harpoon",
        },
        {
          plugin: "harpoon",
          key: "<C-e>",
          desc: "Alternar menu rápido do Harpoon",
        },
        {
          plugin: "harpoon",
          key: "<leader>h1",
          desc: "Navegar para arquivo 1",
        },
        {
          plugin: "harpoon",
          key: "<leader>h2",
          desc: "Navegar para arquivo 2",
        },
        {
          plugin: "harpoon",
          key: "<leader>h3",
          desc: "Navegar para arquivo 3",
        },
        {
          plugin: "harpoon",
          key: "<leader>h4",
          desc: "Navegar para arquivo 4",
        },
        {
          plugin: "harpoon",
          key: "<leader>hp",
          desc: "Ir para arquivo anterior",
        },
        {
          plugin: "harpoon",
          key: "<leader>hn",
          desc: "Ir para próximo arquivo",
        },
        {
          plugin: "geral",
          key: "<leader>qa",
          desc: "Sair do Neovim sem salvar",
        },
        {
          plugin: "geral",
          key: "<leader>b",
          desc: "Focar no último buffer ativo",
        },
      ];

      const introContent = {
        normal: {
          title: "Modo Normal: O Centro de Comando",
          text: "Este é seu modo principal. Use-o para navegar pelo arquivo e executar comandos de edição. A eficiência no Vim vem de dominar a navegação neste modo.",
        },
        insert: {
          title: "Modo de Inserção: Digitando Texto",
          text: "Use este modo apenas para digitar. O objetivo é entrar, escrever o que precisa e sair rapidamente de volta para o Modo Normal.",
        },
        visual: {
          title: "Modo Visual: Seleção Precisa",
          text: "Use para selecionar blocos de texto (caracteres, linhas ou retângulos) e aplicar um comando a toda a seleção de uma vez.",
        },
      };

      const state = {
        mode: "normal",
        level: "all",
        plugin: "neotree",
      };

      const mainNav = document.getElementById("main-nav");
      const subNavContainer = document.getElementById("sub-nav-container");
      const subNavNormal = document.getElementById("sub-nav-normal");
      const commandsGrid = document.getElementById("commands-grid");
      const introTitle = document.getElementById("intro-title");
      const introText = document.getElementById("intro-text");
      const pluginNav = document.querySelector("#plugin-keybinds .flex");
      const pluginGrid = document.getElementById("plugin-grid");
      const themeToggle = document.getElementById("theme-toggle");
      const lightIcon = document.getElementById("theme-icon-light");
      const darkIcon = document.getElementById("theme-icon-dark");
      const modal = document.getElementById("explanation-modal");
      const modalTitle = document.getElementById("explanation-modal-title");
      const modalContent = document.getElementById("explanation-modal-content");
      const modalClose = document.getElementById("explanation-modal-close");

      const loadingSpinner = `<div class="flex justify-center items-center h-32"><div class="loader"></div></div>`;

      async function getExplanation(key, desc) {
        modal.style.display = "flex";
        modalTitle.textContent = key;
        modalContent.innerHTML = loadingSpinner;

        const prompt = `Explique o comando do Vim/Neovim "${key}" de forma detalhada e amigável para iniciantes. A descrição base é: "${desc}". Inclua o que ele faz, como usá-lo e um exemplo prático de uso. Formate a resposta de forma clara, usando negrito para o comando e blocos de código para exemplos.`;

        let chatHistory = [{ role: "user", parts: [{ text: prompt }] }];
        const payload = { contents: chatHistory };
        const apiKey = "";
        const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent?key=${apiKey}`;

        try {
          const response = await fetchWithRetry(apiUrl, {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify(payload),
          });

          if (!response.ok) {
            throw new Error(
              `API request failed with status ${response.status}`,
            );
          }

          const result = await response.json();
          if (
            result.candidates &&
            result.candidates.length > 0 &&
            result.candidates[0].content &&
            result.candidates[0].content.parts &&
            result.candidates[0].content.parts.length > 0
          ) {
            const text = result.candidates[0].content.parts[0].text;
            modalContent.innerHTML = text
              .replace(/```([\s\S]*?)```/g, "<pre>$1</pre>")
              .replace(/\*\*(.*?)\*\*/g, "<strong>$1</strong>");
          } else {
            throw new Error("Resposta da API inválida.");
          }
        } catch (error) {
          modalContent.textContent =
            "Desculpe, não foi possível obter a explicação. Tente novamente mais tarde.";
        }
      }

      async function fetchWithRetry(url, options, retries = 3, delay = 1000) {
        for (let i = 0; i < retries; i++) {
          try {
            return await fetch(url, options);
          } catch (error) {
            if (i === retries - 1) throw error;
            await new Promise((res) => setTimeout(res, delay * Math.pow(2, i)));
          }
        }
      }

      function createCard(cmd, isPlugin = false) {
        const card = document.createElement("div");
        card.className =
          "card bg-white dark:bg-stone-800 p-4 rounded-lg shadow-sm border border-stone-200 dark:border-stone-700 flex flex-col items-center text-center";

        let cardContent = `
                <code class="fira-code text-lg font-semibold text-green-800 bg-green-100 dark:text-green-300 dark:bg-green-900/50 px-3 py-1 rounded-md mb-3">${cmd.key.replace(/</g, "&lt;").replace(/>/g, "&gt;")}</code>
                <p class="text-sm text-stone-600 dark:text-stone-400 leading-snug flex-grow mb-4">${cmd.desc}</p>
                <button data-key="${cmd.key}" data-desc="${cmd.desc}" class="explain-btn mt-auto text-xs font-semibold bg-green-100 text-green-800 dark:bg-green-900/50 dark:text-green-300 py-1 px-3 rounded-full hover:bg-green-200 dark:hover:bg-green-800/70">✨ Explicar Comando</button>
            `;

        if (isPlugin) {
          card.innerHTML = `
                    <div class="flex items-center w-full mb-4">
                        <code class="fira-code text-base font-semibold text-green-800 bg-green-100 dark:text-green-300 dark:bg-green-900/50 px-3 py-1 rounded-md mr-4">${cmd.key.replace(/</g, "&lt;").replace(/>/g, "&gt;")}</code>
                        <p class="text-sm text-stone-700 dark:text-stone-300 text-left flex-grow">${cmd.desc}</p>
                    </div>
                    <button data-key="${cmd.key}" data-desc="${cmd.desc}" class="explain-btn mt-auto text-xs font-semibold bg-green-100 text-green-800 dark:bg-green-900/50 dark:text-green-300 py-1 px-3 rounded-full hover:bg-green-200 dark:hover:bg-green-800/70">✨ Explicar Comando</button>
                `;
          card.classList.remove("text-center");
        } else {
          card.innerHTML = cardContent;
        }

        return card;
      }

      function renderCommands() {
        commandsGrid.innerHTML = "";
        const filteredCommands = commandsData.filter((cmd) => {
          if (cmd.mode !== state.mode) return false;
          if (
            state.mode === "normal" &&
            state.level !== "all" &&
            cmd.level != state.level
          )
            return false;
          return true;
        });
        filteredCommands.forEach((cmd) =>
          commandsGrid.appendChild(createCard(cmd)),
        );
      }

      function renderPluginKeybinds() {
        pluginGrid.innerHTML = "";
        const filteredBinds = pluginKeybinds.filter(
          (bind) => bind.plugin === state.plugin,
        );
        filteredBinds.forEach((bind) =>
          pluginGrid.appendChild(createCard(bind, true)),
        );
      }

      function updateUI() {
        document
          .querySelectorAll("#main-nav .nav-btn")
          .forEach(
            (btn) => (btn.dataset.active = btn.dataset.mode === state.mode),
          );
        const isNormalMode = state.mode === "normal";
        subNavContainer.style.display = isNormalMode ? "block" : "none";
        if (isNormalMode) {
          document
            .querySelectorAll("#sub-nav-normal .sub-nav-btn")
            .forEach(
              (btn) => (btn.dataset.active = btn.dataset.level == state.level),
            );
        }
        introTitle.textContent = introContent[state.mode].title;
        introText.textContent = introContent[state.mode].text;
        document
          .querySelectorAll(".plugin-nav-btn")
          .forEach(
            (btn) => (btn.dataset.active = btn.dataset.plugin === state.plugin),
          );
        renderCommands();
        renderPluginKeybinds();
      }

      function applyTheme(theme) {
        if (theme === "dark") {
          document.documentElement.classList.add("dark");
          lightIcon.classList.remove("hidden");
          darkIcon.classList.add("hidden");
        } else {
          document.documentElement.classList.remove("dark");
          lightIcon.classList.add("hidden");
          darkIcon.classList.remove("hidden");
        }
      }

      themeToggle.addEventListener("click", () => {
        const newTheme = document.documentElement.classList.contains("dark")
          ? "light"
          : "dark";
        localStorage.setItem("theme", newTheme);
        applyTheme(newTheme);
      });

      mainNav.addEventListener("click", (e) => {
        if (e.target.matches("button")) {
          state.mode = e.target.dataset.mode;
          state.level = "all";
          updateUI();
        }
      });
      subNavNormal.addEventListener("click", (e) => {
        if (e.target.matches("button")) {
          state.level = e.target.dataset.level;
          updateUI();
        }
      });
      pluginNav.addEventListener("click", (e) => {
        if (e.target.matches("button")) {
          state.plugin = e.target.dataset.plugin;
          updateUI();
        }
      });

      document.body.addEventListener("click", (e) => {
        if (e.target.classList.contains("explain-btn")) {
          const key = e.target.dataset.key;
          const desc = e.target.dataset.desc;
          getExplanation(key, desc);
        }
      });

      modalClose.addEventListener(
        "click",
        () => (modal.style.display = "none"),
      );
      modal.addEventListener("click", (e) => {
        if (e.target === modal) {
          modal.style.display = "none";
        }
      });

      document.addEventListener("DOMContentLoaded", () => {
        const savedTheme =
          localStorage.getItem("theme") ||
          (window.matchMedia("(prefers-color-scheme: dark)").matches
            ? "dark"
            : "light");
        applyTheme(savedTheme);
        updateUI();
      });
    </script>
  </body>
</html>
